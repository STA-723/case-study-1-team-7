---
title: "Investigating the Effects of DDE and PCB Exposure on Premature Delivery"
author: "Youngsoo Baek, Yunran Chen and Xiaojun Zheng"
fontsize: "11pt"
output:
  pdf_document: 
        latex_engine: xelatex
  html_document:
    keep_md: yes
    fig_caption: TRUE
header-includes:  
  \usepackage{float} 
  \floatplacement{figure}{H}
---

```{r setup, echo=F}
knitr::opts_chunk$set(fig.align='center')
Longnecker <- readRDS("Longnecker.rds")
```


#### Executive Summary

We study the association between exposure to Dichlorodiphenyldichloroethylene (DDE) and 12 Polychlorinated Biophenyl (PCB) members and the risk of premature delivery. To address the collinearity caused by PCB members, we consider a two-stage modeling process to hybrid Principal Component Analysis (PCA) to binary/ordinal logistic regression. As an alternative, we also consider selecting representative PCBs based on lasso in the first stage. Both models suggest higher exposure to both DDE and PCB is associated with higher odds of preterm delivery.  

The project studied the association between exposure to Dichlorodiphenyldichloroethylene (DDE) and 12 Polychlorinated Biophenyl (PCB) members and the risk of premature delivery. Because of the collinearity caused by PCB members, two approaches applied follow a two-stage modeling process. One is to use hybrid Principal Component Analysis (PCA) to binary/ordinal logistic regression, and the other is to select important PCBs based on lasso regression, and then fit the binary/ordinal logistic model. The analysis of both methods suggest that higher exposure to both DDE and PCB is associated with higher odds of preterm delivery.

#### Introduction

Dichlorodiphenyltrichloroethane (DDT) and Polychlorinated biphenyl (PCB) were proved to be toxic, leading to a ban on use in United States in 1972, 1978 respectively. We are interested in whether and how the DDE and PCB relate to the risk of premature delivery adjusting other possible confounders such as physical background, demographic background and socio-economic status. The data comes from a subsample of the US Collaborative Perinatal Project (CPP) conducted by Longecker et al. (2001), which contains concentration doses for DDE and PCBs as well as the gestational ages of 2380 women in 12 medical centers. Other potential predictors are provided such as triglycerides and cholesterol (fat chemicals), smoking status and demographic characteristics such as race, age and socio-economic index.

#### Materials and Methods

In order to model the linear association between the probability of preterm delivery and predictors of interest on some suitable scale, We considered a logistic regression model, where the log-odds of premature delivery are modeled by a linear combination of DDE and PCB levels, and we defined a birth that takes place less than 37 weeks as preterm delievery. While binary logistic regression is a standard method, we suffer loss of information on different delivery periods, which contains information about different levels of risk on the infants' health. Therefore, we binned the gestational ages to reflect increasing levels of risk prescribed by NIH and consider an ordinal logistic regression as follows:
$${\rm Pr}(Y_i\leq k|\mathbf{x}_i) = {\rm logit}^{-1}(\alpha_{k} + \mathbf{x}_i^T\beta)\iff {\rm Odds}(Y_i \leq k|\mathbf{x}_i) = e^{\alpha_k} e^{\mathbf{x}_i^T\beta},$$
where $Y_i$ with four possible values, $k=1,2,3,4$, each corresponding to different categories of preterm delivery with increasing level of infant health risk. We considered four categories with 32, 36, 37 as thresholds to bin the gestational age into four categories: "very preterm", "moderate", "late preterm" and "normal-late". The model comes with an assumption that the odds corresponding to each of these levels are proportional. The data exhibit some indication that the model assumption can be violated, which will be discussed in the Discussion Section. (i.e., DDE is observed to have stronger association with premature delivery, as we move from late preterm (nearly around 37-week threshold) to earlier delivery periods.)

The main challenge is high correlation between multiple PCB variables. High correlation between predictors in the regression is known to inflate standard errors of the estimated effects, so our inference on not only the PCBs, but also for other predictors, can be severely limited by adjusting for all of them. Two approaches are discussed. We excluded all PCB levels and included the first principal component from the principal components analysis (PCA). Since this principal component is a weighted sum of all PCB members that are standardized to unit scale, it can be thought of as a proxy variable for "adjusted total" PCB levels. Direct interpretation of the effect magnitude based on regression estimates, however, is not feasible. Alternatively, we used variable selection methods to exclude PCB variables that are deemed unimportant for the model, and re-fit the regression based on the selected variables only. Both appraoches requir a two-stage procedure. In the first stage, we either construct a new PCB predictor based on Principal Component Analysis (PCA) or select representative PCBs by Lasso. In the second stage, we include the PCB predictors from the first stage and other potential predictors in the binary/ordinary logistic regression.

#### Results

##### Exploratory Data Analysis

We dropped `albumin` since 90\% data is missing (Figure \ref{fig:mis}), and we excluded one subject for whom no PCB levels were measured. We noticed that three score variables corresponding to the subjects' income, occupation, and education have substantial number of missing values (20\%),and we made different decisions on dealing with the missing values. In the PCA-logistic model, the ANOVA test suggests that including socio-economic indices (score variables) in the model is accepted. while in the Lasso-logistic model, we excluded them. A sensitivity analysis is conducted to address the missing problem. 

Additonally, a severe multicollinearity exists among PCBs as shown in Figure \ref{fig:cor}, and a heterogeneity across centers exists as shown in Figure \ref{fig:heter_center}. We noticed that different centers have distinct demographic background (such as race and income), so we assume each center cannot borrow information from others, and then considered fix effects for 12 centers instead of random effects. For simplicity, we did not consider the interaction between centers and other predictors.

##### Main Results

Based on the binary logistic regression model, the significant predictors include DDE, proxy variable for PCB levels, triglyceride and cholesterol levels, along with mean shifts in centers (15,37,82) for which subjects are primarily of black race. Estimated model effects and their 95\% confidence intervals can be found in Table 1. Most of the estimates have a direct scientific interpretation. For instance, for a 1$\mu$g increase in DDE exposure, adjusted for all other variables, a mother has 0.8\% increased odds of premature delivery. Similarly, for a 1g/dL increase in triglyceride level, adjusted for other variables, a mother has 0.3\% increased odds of premature delivery. Such inference, however, is hampered for PCB, as discussed above. We do get an expected positive sign, indicating that PCB has effect oc increasing preterm delivery odds. Ordinal logistic model estimates mostly agree in the signs and magnitudes of the effects; however, cholesterol level is no longer considered a significant variable. 

Based on the lasso regression, we selected PCB 074 and PCB 153 as the representatives for PCBs with the minimizing binomial deviance criterion. The likelihood ratio test suggests that the potential effects of PCB 74 and PCB 153 on the risk of preterm delivery are significantly non-zero (Table 3). Then We fit the models using selected PCBs, DDE and other demorgraphic predictors for adjustation in binary and ordinal logistic regression. The estimated coefficients are similar to those using PCA-logistic model, and can be found in Table 2. Thus, we can also conclude that higher exposure to both DDE and PCB is associated with higher odds of preterm delivery.

The lasso-logistic model performs slightly better than the PCA-logistic model in terms of BIC (1625 and 2054 for binary and ordinal logistic regression versus 2061 and 2643 for PCA-logistic models) and diagnosis plots. Additionally, the lasso-logistic model takes advantages on interpretating the potential effect of PCBs. For instance, in the logistic model, for one unit increase in PCB 074 exposure, adjusted for all other variables (notice socio-economic status are adjusted in the model), a mother is expected to has 44.5\% increased odds of premature delivery. 

##### Sensitivity Analysis

As introduced above, the models selected by lasso regression involve the score variables about income, education and occupation. With about 20% missingness of score variables, we decided to impute the score variables, and refit the models to see whether there is signiciant change in our result. The method of imputation is called Predictive Mean Matching, which extracts the information from the observations without missing values, and uses that to make assumption about the missing entry. Specially, for each missing entry, the method forms a set of complete observations with the predicted values that are close to the predcition of that, and randomly draws the observed value of an obervation to replace the missing value.

After refitting the logistic and ordinal logistic models using the imputed data, we observed that there is almost no change for the estimates of the coefficient for DDE, PCB_074 and PCB_153. At the same time, the confidence intervals for those coefficients narrow a little bit, which match up our intuition. Thus, our models generated based on a lasso selection seems to be robust. 


#### Discussion

In addition to the frequentist methods we have described above, we also tried Bayesian methods, including Bayesian Model Averaging, Bayesian lasso, and a Hierarchical prior on center effects. Fortunately, we were able to select the same PCB covariates using Bayesian lasso, but the results for prediction is not satisfying. The confidence intervals for coefficients are large, and cover $0$, and mixing seems poor when we generated $10000$ samples. 


\clearpage

#### Tables and Figures

##### EDA

```{r, message=FALSE, warning=FALSE, include=FALSE}
library(arm)
library(corrplot)
library(naniar)
library(ggplot2)
library(dplyr)
library(tibble)
library(tidyr)
library(purrr)
library(lme4)
library(MASS)
library(ggmosaic)
library(mice)
library(ordinalNet)
library(glmnet)
```

```{r mis, echo=FALSE, fig.cap="\\label{fig:mis} Missing Data", message=FALSE, warning=FALSE, cache=TRUE}
data=readRDS("Longnecker.rds")
data=data %>% dplyr::select(gestational_age, dde:cholesterol, center)
gg_miss_upset(data)
```

```{r hist, echo=FALSE, message=FALSE, warning=FALSE,cache=TRUE}
data_46=data#%>%mutate(y=gestational_age)
data_46[data_46$gestational_age>46,"gestational_age"]=46
data_46=data_46%>%select(-albumin)%>%mutate(race=factor(race),center=factor(center))
data_46$earlylvl <- cut(data_46$gestational_age,
                                       breaks = c(0, 31, 33, 36, 46), right = TRUE)
#data_46 %>%
#  dplyr::select(gestational_age:triglycerides,-triglycerides,-dde) %>%
#  gather() %>% 
#  ggplot(aes(value)) +
#    facet_wrap(~ key, scales = "free") +
#    geom_histogram() + theme_bw()
```

```{r corrplot, echo=FALSE,cache=TRUE, fig.width = 3.4,fig.cap="\\label{fig:cor} Correlation plot across PCBs"}
data_ = data %>% mutate(race=as.numeric(race))
M2 = cor(as.matrix(na.omit(data_%>%select(pcb_028:pcb_203))))
corrplot.mixed(M2,number.cex=0.7, upper="ellipse",tl.cex=0.5)
```

```{r heter, echo=FALSE, cache=TRUE,fig.cap="\\label{fig:heter_center} Heterogeneity across Centers"}
ggplot(data,mapping = aes(x=as.factor(center),y=gestational_age))+geom_boxplot()+theme_bw()+xlab("center")
```

##### PCA-logistic

```{r boilerplate_for_models, echo=F, include=F}
Longnecker <- readRDS("./Longnecker.rds")
Longnecker <- Longnecker[,colnames(Longnecker)!="albumin"] # Throw away albumin
Longnecker$center <- as.factor(Longnecker$center) # Factorize center
Longnecker[Longnecker$gestational_age > 46, "gestational_age"] <- 46 # Truncate at age == 46
complete_formula <- as.formula(
  "gestational_age ~ dde + pcb_028 + pcb_052 + pcb_074 + pcb_105 + 
  pcb_118 + pcb_153 + pcb_170 + pcb_138 + pcb_180 + pcb_194 + pcb_203 + 
  triglycerides + race + maternal_age + smoking_status + cholesterol + center"
)
x <- model.matrix(complete_formula, data = Longnecker)
miss_indices <- as.integer(row.names(x))
Longnecker_complete <- Longnecker[miss_indices,] # Only those non-missing obs.
PC1_pcb <- prcomp(x[,grepl("pcb", colnames(x))], scale.=TRUE)$x[,1]
Longnecker_complete_pc <- cbind.data.frame(
  Longnecker_complete[,!grepl("pcb", colnames(Longnecker_complete))],
  PC1 = PC1_pcb)
# Mutation: gestational week => categorical variables
Longnecker_complete_pc$early <- (Longnecker_complete_pc$gestational_age < 37)
Longnecker_complete_pc$earlylvl <- cut(Longnecker_complete_pc$gestational_age,
                                       breaks = c(0, 31, 33, 36, 46), right = TRUE)
```


```{r, echo=F, include=T}
pca_formula1 <- as.formula("early ~ dde + PC1 + 
  triglycerides + race + maternal_age + smoking_status + cholesterol + center")
pca_formula2 <- as.formula("earlylvl ~ dde + PC1 + 
  triglycerides + race + maternal_age + smoking_status + cholesterol + center")
# 1. Binary logistic
llm_with_pc <- glm(pca_formula1, family = binomial, 
                   data = Longnecker_complete_pc)
# 2. Ordinal logistic
olm_with_pc <- polr(pca_formula2, data = Longnecker_complete_pc)
#
llm_coefs <- coef(llm_with_pc)
llm_confint <- suppressMessages(confint(llm_with_pc))
llm_coefs <- cbind.data.frame(Mean = llm_coefs, llm_confint)
#
olm_coefs <- -1 * coef(olm_with_pc)
olm_confint <- suppressMessages(-1 * confint(olm_with_pc)[,c(2,1)])
olm_coefs <- suppressMessages(cbind.data.frame(Mean = olm_coefs, olm_confint))
colnames(olm_coefs) <- colnames(olm_coefs)[c(1,3,2)]
```

```{r, echo=F, include=T}
knitr::kable(llm_coefs, format = "latex", digits = 3,
             caption = "Logistic")
knitr::kable(olm_coefs, format = "latex", digits = 3,
             caption = "Ordinal logistic")
```

```{r, echo=F, message=F, include=T}
blo <- summary(olm_with_pc)$coefficients[20:22, "Value"] # baseline log-odds
bprobs <- exp(blo) / (1+exp(blo))
# Transforming +/- 2SE to probability scale
odds_lb <- exp(blo) * exp(-2 * summary(olm_with_pc)$coefficients[20:22, "Std. Error"])
odds_ub <- exp(blo) * exp(2 * summary(olm_with_pc)$coefficients[20:22, "Std. Error"])
probs_lb <- odds_lb / (1 + odds_lb); probs_ub <- odds_ub / (1 + odds_ub) 
knitr::kable(cbind.data.frame("Lower bound" = probs_lb,
                              "Mean" = bprobs,
                              "Upper bound" = probs_ub,
                              row.names = c("Very preterm", "Moderately", "Late preterm")
                              ),
             format = "latex", digits = 3)
```

##### Lasso-logistic

```{r lasso, cache=T,echo=F, eval=T}
library("glmnet")
data=readRDS("Longnecker.rds")
data=data%>%dplyr::select(gestational_age,dde:cholesterol,center)
data_46=data%>%mutate(y=gestational_age)
data_46[data_46$y>46,"y"]=46
data_46=data_46%>%dplyr::select(-gestational_age,-albumin)%>%mutate(race=factor(race),center=factor(center))
data_46_wscore=data_46%>%na.omit()
set.seed(123)
train.data=data_46_wscore
x <- model.matrix(y~., train.data)[,-1]
# Convert the outcome (class) to a numerical variable
y <- ifelse(train.data$y<37,1,0)
train.data$y=y
cv.lasso2 <- cv.glmnet(x, y, alpha = 1,family="binomial")
# Fit the final model on the training data
model2 <- glmnet(x, y, alpha = 1,family="binomial",
                lambda = cv.lasso2$lambda[27])
#plot(cv.lasso2) # logistic
#coef(model2) # dde, pcb_074, 153; the one with min mse, if relax the penalty a little bit, will include all the demographic characters
```

```{r glmlasso, cache=T,echo=F, eval=T}
formula_lasso_w <- as.formula(
  "y ~ dde + pcb_074 + pcb_153 + 
  triglycerides + race + maternal_age + smoking_status + cholesterol + center + score_education + score_income + score_occupation"
)
formula_lasso_o <- as.formula(
  "y ~ dde + 
  triglycerides + race + maternal_age + smoking_status + cholesterol + center + score_education + score_income + score_occupation"
)
model21_w <- glm(formula_lasso_w, family = binomial, 
                   data = train.data)
model21_o <- glm(formula_lasso_o, family = binomial, 
                   data = train.data)
```

```{r cilassolog, cache=T,echo=F, include=FALSE}
lasso_coef <- coef(model21_w)
lasso_confint <- suppressMessages(confint(model21_w))
lassso_coefs <- cbind.data.frame(Mean = lasso_coef, lasso_confint)
```

```{r ordlasso, cache=T,echo=F, include=FALSE}
library("ordinalNet")
train.data.ord=data_46_wscore
train.data.ord$y <- cut(train.data.ord$y,
                                       breaks = c(0, 31, 33, 36, 46), right = TRUE)
ord.x=model.matrix(y~.,data=train.data.ord)
#ordlasso.model <- ordinalNet(ord.x, train.data.ord$y, family="cumulative", link="logit",
#                   parallelTerms=TRUE, nonparallelTerms=FALSE,alpha=1)
#coef(ordlasso.model) # pcb_028,074,153,138
formula_lasso_w.ord <- as.formula(
  "y ~ dde + pcb_074 + pcb_153 +
  triglycerides + race + maternal_age + smoking_status + cholesterol + center + score_education + score_income + score_occupation"
)
formula_lasso_o.ord <- as.formula(
  "y ~ dde + 
  triglycerides + race + maternal_age + smoking_status + cholesterol + center + score_education + score_income + score_occupation"
)
model21_w.ord <- polr(formula_lasso_w.ord, 
                   data = train.data.ord)
model21_o.ord <- polr(formula_lasso_o.ord, 
                   data = train.data.ord)
```

```{r cilassoord, include=FALSE}
olasso_coefs <- -1 * coef(model21_w.ord)
olasso_confint <- suppressMessages(-1 * confint(model21_w.ord)[,c(2,1)])
olasso_coefs <- suppressMessages(cbind.data.frame(Mean = olasso_coefs, olasso_confint))
colnames(olasso_coefs) <- colnames(olasso_coefs)[c(1,3,2)]
```

```{r lassotest,include=FALSE}
a1=anova(model21_o,model21_w,test="LRT")[2,c(4,3,5)]
a2=anova(model21_o.ord,model21_w.ord)[2,c(6,5,7)]
colnames(a1)=c("Deviance","Df","Pr(>Chi)")
colnames(a2)=c("Deviance","Df","Pr(>Chi)")
tbl_test=rbind(a1,a2)
rownames(tbl_test)=NULL
```


```{r lassores, echo=F, include=T}
knitr::kable(lassso_coefs, format = "latex", digits = 3,
             caption = "Logistic")
knitr::kable(olasso_coefs, format = "latex", digits = 3,
             caption = "Ordinal logistic")
```

```{r modelcompare, echo=F,include=T}
BIC=c(BIC(llm_with_pc),BIC(olm_with_pc),BIC(model21_w),BIC(model21_w.ord))
model.name=c("PCA-binary","PCA-ordinal","Lasso-binary","Lasso-ordinal")
```

```{r, echo=F, include=T,fig.cap="\\label{fig:dia_pca} Diagnosis of Lasso-logistic"}
par(mfrow = c(1, 2))
binnedplot(fitted(llm_with_pc),
           residuals(llm_with_pc, type = "response"),
           nclass = 40,
           xlab = "Fitted response",
           ylab = "Residual",
           main = "PCA-Logistic regression (40 bins)")

binnedplot(fitted(model21_w),
           residuals(model21_w, type = "response"),
           nclass = 40,
           xlab = "Fitted response",
           ylab = "Residual",
           main = "Lasso-Logistic regression (40 bins)")
```

##### Sensitivity Analysis

```{r lassox, cache=T, include=FALSE}
data=readRDS("Longnecker.rds")
data=data%>%dplyr::select(gestational_age,dde:cholesterol,center)
data_46=data%>%mutate(y=gestational_age)
data_46[data_46$y>46,"y"]=46
data_46=data_46%>%dplyr::select(-gestational_age,-albumin)%>%mutate(race=factor(race),center=factor(center))
data_46_wscore=data_46%>%na.omit()
set.seed(123)
train.data=data_46_wscore
x <- model.matrix(y~., train.data)[,-1]
# Convert the outcome (class) to a numerical variable
y <- ifelse(train.data$y<37,1,0)
train.data$y=y
cv.lasso2 <- cv.glmnet(x, y, alpha = 1,family="binomial")
# Fit the final model on the training data
model2 <- glmnet(x, y, alpha = 1,family="binomial",
                lambda = cv.lasso2$lambda.min)
```

```{r glmlassox, cache=T,echo=F, eval=T}
formula_lasso_w <- as.formula(
  "y ~ dde + pcb_074 + pcb_153 + 
  triglycerides + race + maternal_age + smoking_status + cholesterol + center + score_education + score_income + score_occupation"
)
formula_lasso_o <- as.formula(
  "y ~ dde + 
  triglycerides + race + maternal_age + smoking_status + cholesterol + center + score_education + score_income + score_occupation"
)
model21_w <- glm(formula_lasso_w, family = binomial, 
                   data = train.data)
model21_o <- glm(formula_lasso_o, family = binomial, 
                   data = train.data)
```

```{r cilassologx, include=FALSE}
lasso_coef <- coef(model21_w)
lasso_confint <- suppressMessages(confint(model21_w))
lassso_coefs <- cbind.data.frame(Mean = lasso_coef, lasso_confint)
```

```{r cache=T,echo=F}
train.data.ord=data_46_wscore
train.data.ord$y <- cut(train.data.ord$y,
                                       breaks = c(0, 31, 33, 36, 46), right = TRUE)
ord.x=model.matrix(y~.,data=train.data.ord)
#ordlasso.model <- ordinalNet(ord.x, train.data.ord$y, family="cumulative", link="logit",
#                   parallelTerms=TRUE, nonparallelTerms=FALSE,alpha=1)
#coef(ordlasso.model) # pcb_028,074,153,138
formula_lasso_w.ord <- as.formula(
  "y ~ dde + pcb_074 + pcb_153 +
  triglycerides + race + maternal_age + smoking_status + cholesterol + center + score_education + score_income + score_occupation"
)
formula_lasso_o.ord <- as.formula(
  "y ~ dde + 
  triglycerides + race + maternal_age + smoking_status + cholesterol + center + score_education + score_income + score_occupation"
)
model21_w.ord <- polr(formula_lasso_w.ord, 
                   data = train.data.ord)
model21_o.ord <- polr(formula_lasso_o.ord, 
                   data = train.data.ord)
```

```{r ,cache=T,echo=F, include=FALSE}
olasso_coefs <- -1 * coef(model21_w.ord)
olasso_confint <- suppressMessages(-1 * confint(model21_w.ord)[,c(2,1)])
olasso_coefs <- suppressMessages(cbind.data.frame(Mean = olasso_coefs, olasso_confint))
colnames(olasso_coefs) <- colnames(olasso_coefs)[c(1,3,2)]
```


```{r echo=F, cache=T, include=F}
data=readRDS("Longnecker.rds")
data=data%>%dplyr::select(gestational_age,dde:cholesterol,center)
data_46=data%>%mutate(y=gestational_age)
data_46[data_46$y>46,"y"]=46
data_46=data_46%>%dplyr::select(-gestational_age,-albumin)%>%mutate(race=factor(race),center=factor(center))

data_impute<- mice(data = data_46, m = 1, method = "pmm")
data <- complete(data_impute)

train.data=data

set.seed(123)
x <- model.matrix(y~., train.data)[,-1]
# Convert the outcome (class) to a numerical variable
y <- ifelse(train.data$y<37,1,0)
train.data$y=y
cv.lasso2 <- cv.glmnet(x, y, alpha = 1,family="binomial")
# Fit the final model on the training data
model2 <- glmnet(x, y, alpha = 1,family="binomial",
                lambda = cv.lasso2$lambda[27])


formula_lasso_w <- as.formula(
  "y ~ dde + pcb_074 + pcb_153 + 
  triglycerides + race + maternal_age + smoking_status + cholesterol + center + score_education + score_income + score_occupation"
)

model21_w <- glm(formula_lasso_w, family = binomial, 
                   data = train.data)

lasso_coef_impute <- coef(model21_w)
lasso_confint_impute <- suppressMessages(confint(model21_w))
lassso_coefs_impute <- cbind.data.frame(Mean = lasso_coef, lasso_confint)


sensi_logistic<- data.frame(name = c("dde", "dde", "pcb074", "pcb074", "pcb153", "pcb153"), mean = c(lassso_coefs[2,1], lassso_coefs_impute[2,1], lassso_coefs[3,1], lassso_coefs_impute[3,1], lassso_coefs[4,1], lassso_coefs_impute[4,1]), lower = c(lassso_coefs[2,2], lassso_coefs_impute[2,2], lassso_coefs[3,2], lassso_coefs_impute[3,2], lassso_coefs[4,2], lassso_coefs_impute[4,2]), higher = c(lassso_coefs[2,3], lassso_coefs_impute[2,3], lassso_coefs[3,3], lassso_coefs_impute[3,3], lassso_coefs[4,3], lassso_coefs_impute[4,3]), type = c("missing", "impute", "missing", "impute", "missing", "impute"))
```

```{r echo=F, fig.cap="\\label{fig:dia_sensi1} Sensitivity Analysis (Binary)", cache=T,fig.width=4.5}
ggplot(sensi_logistic, aes(x = name, y = mean,ymin = lower, ymax =higher, 
               color=type)) +
    geom_point(position=position_dodge(width=0.5), size = 2.5) + 
    geom_linerange(position=position_dodge(width=0.5), size =0.5) +  theme_bw() +
    labs(colour="Type", y="Log Odds", x="") + 
    theme(plot.title = element_text(size = 12,face="bold" )) + 
    theme(axis.title=element_text(size="12") ,axis.text=element_text(size=12)) 

```

```{r ordlassox, cache=T,echo=F,include=F}
data=readRDS("Longnecker.rds")
data=data%>%dplyr::select(gestational_age,dde:cholesterol,center)
data_46=data%>%mutate(y=gestational_age)
data_46[data_46$y>46,"y"]=46
data_46=data_46%>%dplyr::select(-albumin)%>%mutate(race=factor(race),center=factor(center))

data_impute<- mice(data = data_46, m = 1, method = "pmm")
data <- complete(data_impute)
train.data.ord<- data
train.data.ord$y <- cut(train.data.ord$gestational_age,
                                       breaks = c(0, 31, 33, 36, 46), right = TRUE)
ord.x=model.matrix(y~.,data=train.data.ord)
#ordlasso.model <- ordinalNet(ord.x, train.data.ord$y, family="cumulative", link="logit",
#                   parallelTerms=TRUE, nonparallelTerms=FALSE,alpha=1)
#coef(ordlasso.model) # pcb_028,074,153,138
formula_lasso_w.ord <- as.formula(
  "y ~ dde + pcb_074 + pcb_153 +
  triglycerides + race + maternal_age + smoking_status + cholesterol + center + score_education + score_income + score_occupation"
)

model21_w.ord <- polr(formula_lasso_w.ord, 
                   data = train.data.ord)

```

```{r cilassoordx, include=FALSE}
olasso_coefs_impute <- -1 * coef(model21_w.ord)
olasso_confint_impute <- suppressMessages(-1 * confint(model21_w.ord)[,c(2,1)])
olasso_coefs_impute <- suppressMessages(cbind.data.frame(Mean = olasso_coefs_impute, olasso_confint_impute))
colnames(olasso_coefs_impute) <- colnames(olasso_coefs_impute)[c(1,3,2)]
```

```{r cache=T,echo=F, include=T,fig.cap="\\label{fig:dia_sensi2} Sensitivity Analysis (Ordinal),fig.width=4.5"}
sensi_logistic<- data.frame(name = c("dde", "dde", "pcb074", "pcb074", "pcb153", "pcb153"), mean = c(olasso_coefs[1,1], olasso_coefs_impute[1,1], olasso_coefs[2,1], olasso_coefs_impute[2,1], olasso_coefs[3,1], olasso_coefs_impute[3,1]), lower = c(olasso_coefs[1,2], olasso_coefs_impute[1,2], olasso_coefs[2,2], olasso_coefs_impute[2,2], olasso_coefs[3,2], olasso_coefs_impute[3,2]), higher = c(olasso_coefs[1,3], olasso_coefs_impute[1,3], olasso_coefs[2,3], olasso_coefs_impute[2,3], olasso_coefs[3,3], olasso_coefs_impute[3,3]), type = c("missing", "impute", "missing", "impute", "missing", "impute"))

ggplot(sensi_logistic, aes(x = name, y = mean,ymin = lower, ymax =higher, 
               color=type)) +
    geom_point(position=position_dodge(width=0.5), size = 2.5) + 
    geom_linerange(position=position_dodge(width=0.5), size =0.5) +  theme_bw() +
    labs(colour="Type", y="Log Odds", x="") + 
    theme(plot.title = element_text(size = 12,face="bold" )) + 
    theme(axis.title=element_text(size="12") ,axis.text=element_text(size=12)) 
```


\clearpage



##### References

