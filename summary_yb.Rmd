---
title: "Summary of What I've Done"
author: "Youngsoo Baek"
date: "\\today"
output: pdf_document
---

This analysis excludes observations for which there are missing values for any of the variables excluding the response (`gestational_age`) and `albumin`. The observations for which we have missing values for any of the possible model predictors are 525, about `r 525/2380`\% of the data. Response observed at greater than 46 weeks are replaced with the upper bound of 46 weeks, as we suspect many of the extremely long gestational ages recorded are measurement errors, and 46 weeks are considered the upper bound for normal deliveries.

```{r}
Longnecker <- readRDS("./Longnecker.rds")
Longnecker <- Longnecker[,colnames(Longnecker)!="albumin"] # Throw away albumin
Longnecker$center <- as.factor(Longnecker$center) # Factorize center
Longnecker[Longnecker$gestational_age > 46, "gestational_age"] <- 46 # Truncate at age == 46
# Complete case analysis for missing variables

x <- model.matrix(gestational_age ~ . - center - score_education - score_income - score_occupation, data = Longnecker)
miss_indices <- as.integer(row.names(x))
Longnecker_complete <- Longnecker[miss_indices,] # Only those non-missing obs.
```

## Linear Regression
The question of interest is the association between gestational week and chemicals including DDE's and `r sum(grepl("pcb", colnames(Longnecker))` different PCB's. A "naive" linear regression model will include these predictors while adjusting for any observed demographic variables, and triglyceride/cholesterol levels:
$$
\begin{aligned}
\text{gestational age}\sim 1+\text{dde} + \text{pcb} + \text{triglycerides} + \text{cholesterol}+ \text{race} + \text{maternal age} + \text{center}.
\end{aligned}
$$

```{r}

```


```{r}
PC1_pcb <- prcomp(x[,grepl("pcb", colnames(x))])$x[,1]
Longnecker_complete_pc <- cbind.data.frame(Longnecker_complete[,!grepl("pcb", colnames(Longnecker_complete))],
                                           PC1 = PC1_pcb)
lm_with_pc <- lm(gestational_age ~ ., data = Longnecker_complete_pc)

# 2. Logistic regression 
Longnecker_complete_pc$early <- (Longnecker_complete_pc$gestational_age < 37)
llm_with_pc <- glm(early ~ . - gestational_age, family = binomial, data = Longnecker_complete_pc)
est_probs <- predict(llm_with_pc, type = "response") # Estimated probabilities
boxplot(est_probs ~ Longnecker_complete_pc$early) # Classification 

# 3. Linear mixed effects model
library(lme4)
lmm_with_pc <- lmer(gestational_age ~ . - early - center + (1|center), data = Longnecker_complete_pc)
llmm_with_pc <- glmer(early ~ . - gestational_age - center + (1|center), 
                      family = binomial, data = Longnecker_complete_pc)

```

